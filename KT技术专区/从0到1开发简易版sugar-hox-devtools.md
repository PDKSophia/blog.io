---
# ä¸»é¢˜ä½¿ç”¨æ–¹æ³•ï¼šhttps://github.com/xitu/juejin-markdown-themes
theme: juejin
highlight: github
---

## å‰è¨€

> ğŸ“¢ åšå®¢é¦–å‘ : [é˜¿å®½çš„åšå®¢](https://github.com/PDKSophia/blog.io)

å‰å‡ ç¯‡æ–‡ç« çš„æ ¸å¿ƒç‚¹éƒ½æ˜¯å›´ç»•ç€ React çŠ¶æ€ç®¡ç†ï¼Œæ¯”å¦‚ :

- [ã€KTã€‘è½»æ¾æå®š Redux æºç è§£è¯»ä¸ç¼–ç¨‹è‰ºæœ¯](https://juejin.im/post/6844904183426973703)
- [ã€KTã€‘æŸ¥ç¼ºè¡¥æ¼ React çŠ¶æ€ç®¡ç†æ¢ç´¢](https://juejin.im/post/6854573215440699399)
- [ã€KTã€‘ä½ è¿˜åœ¨ redux ä¸­å†™é‡å¤å•°å—¦çš„æ ·æ¿ä»£ç å—](https://juejin.im/post/6874751458508537864)

å…¶ä¸­æœ‰ä¸€ä¸ªé—ç•™çš„ç‚¹ï¼Œé‚£å°±æ˜¯å¯¹äº hox çš„ç®€æ˜“ç‰ˆ devtools å¼€å‘ï¼Œåœ¨[ã€KTã€‘é’ˆå¯¹ Hoxï¼Œæˆ‘å†™äº†ä¸ªç®€é™‹ç»„ä»¶ç‰ˆ dev-tools](https://juejin.im/post/6854573204569227271)æ–‡ç« ä¸­ï¼Œä¸»è¦ä»‹ç» hox å’Œè½åœ° hox å®è·µé‡åˆ°çš„ä¸€äº›å°é—®é¢˜ï¼Œå…¶ä¸­æœ€å¤§çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯ `æ—  dev tools æ”¯æŒ`ï¼Œå½“æ—¶å†™äº†ä¸€ä¸ªå±•ç¤ºå‹ç»„ä»¶ï¼Œå†™äº†éƒ¨åˆ†å®ç°é€»è¾‘ï¼Œä¹‹åå°±å»åšå…¶ä»–äº‹äº†ã€‚ä¸€ç›´è€½æåˆ°ç°åœ¨...

ä»Šå¤©ä¸»è¦æ˜¯èŠèŠå®è·µ `sugar-hox-devtools` è¿‡ç¨‹ä¸­

## èƒŒæ™¯

ä¹‹æ‰€ä»¥åš `sugar-hox-devtools` åŸå› æ˜¯ : åœ¨é¡¹ç›®ä¸­ï¼Œç»„å‘˜ä¹ æƒ¯æ€§çš„éƒ½å†™å‡½æ•°å¼ç»„ä»¶ï¼ŒåŒ…æ‹¬æˆ‘åœ¨å†…ï¼Œç”šè‡³äºæˆ‘å¤§éƒ¨åˆ†éƒ½å†™çš„ hookï¼Œé‚£ä¹ˆæˆ‘å°±åœ¨æƒ³ï¼Œæœ‰æ²¡æœ‰ hooks å†™æ³•ï¼Œå°±èƒ½åšåˆ°çŠ¶æ€ç®¡ç†ï¼Ÿäºæ˜¯æ¥è§¦åˆ°äº† hoxï¼Œ[å¦‚æœä½ è¿˜ä¸äº†è§£ hoxï¼Œä½ å¯ä»¥çœ‹çœ‹å®˜æ–¹è¯´æ˜](https://github.com/umijs/hox)

åœ¨å®é™…è½åœ°åï¼Œæˆ‘å‘ç°ï¼Œå…¶ä»–é—®é¢˜éƒ½å¯ä»¥é¿å…/è§£å†³ï¼Œä½†æ˜¯å¾ˆè›‹ç–¼çš„è«è¿‡äº : `æ—  dev tools æ”¯æŒ`ï¼Œä½ æƒ³æƒ³ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† createModel åŒ…è£¹ä¹‹åï¼Œå¦‚ä½•çŸ¥é“è¿™ä¸ªæ•°æ®æ˜¯å¦çœŸçš„è¢«æŒä¹…åŒ–ã€å…¨å±€å…±äº«å‘¢ ï¼Ÿ

å¸¸è§„æ“ä½œå°±æ˜¯ï¼Œåœ¨ç»„ä»¶ä¸­ import è¿™ä¸ªæ•°æ®æºï¼Œç„¶å console.log æ‰“å°çœ‹çœ‹ï¼Œè¿˜æœ‰ä¸€ç§æƒ…å†µï¼Œé‚£å°±æ˜¯é¡¹ç›®æœ‰å…¶ä»–å°ä¼™ä¼´æ¥æ‰‹äº†ï¼Œç„¶åä»–æƒ³æŸ¥çœ‹ä¸‹ç›®å‰å…¨å±€å…±äº«çš„çŠ¶æ€æœ‰å“ªäº›ï¼Œæ€ä¹ˆåŠï¼Ÿ

å®˜æ–¹ issues ä¹Ÿæœ‰äººé—®åˆ°äº†æ­¤é—®é¢˜ï¼ŒåŒæ—¶æˆ‘ä»¬é¡¹ç›®ä¸­ï¼Œæœ‰äº›å°å‹é¡¹ç›®æˆ–è€…ç‹¬ç«‹æ¨¡å—ï¼Œéƒ½æœ‰ç”¨åˆ°äº† hoxï¼Œäºæ˜¯ï¼Œæˆ‘å†³å®šå…ˆå†™ä¸€ä¸ªç®€æ˜“ç‰ˆçš„ devtoolsï¼Œå‡‘åˆç€ç”¨ï¼Œæ‰€ä»¥ `sugar-hox-devtools` å‡ºç°äº†...

## æœ€ç»ˆæ•ˆæœ

<img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d5458a021344483ba88480a2aee024eb~tplv-k3u1fbpfcp-watermark.image" width=550 />

<img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0f61382160c045caa246d942f14361e8~tplv-k3u1fbpfcp-watermark.image" width=750 />

## ç›¸å…³è¯´æ˜

- sugar-hox-dev-tools æ˜¯ä¸€ä¸ªå¸¦æœ‰ hox åŸ API åŠå¯¼å‡ºä¸€ä¸ªå±•ç¤ºç»„ä»¶çš„ npm åŒ…ï¼Œç”¨äºå±•ç¤ºè¢« createModel åŒ…è£¹çš„æ•°æ®ã€‚[æ›´å¤šåŠŸèƒ½è®¡åˆ’ä¸­]

- ä¿®æ”¹äº† hox ä¸€å°éƒ¨åˆ†æºç ï¼Œå¦‚æœä¾èµ– hox åŒ…ï¼Œé‚£ä¹ˆå¾—åœ¨æ‰“åŒ…çš„æ—¶å€™ï¼Œwebpack æ³¨å…¥æˆ‘è‡ªå·±ä¿®æ”¹çš„éƒ¨åˆ†ä»£ç ï¼Œç›¸å¯¹éº»çƒ¦ï¼Œæˆæœ¬ä¹Ÿé«˜ã€‚äºæ˜¯é‚®ç®±é—®è¿‡ [umi/hox](https://github.com/umijs/hox) çš„å¼€å‘è€…ä¹‹ä¸€ [brickspert](https://github.com/brickspert)ï¼Œç»è¿‡åŒæ„ä¸”æ­¤ä»“åº“ä¸º MIT åè®®ï¼Œæ‰€ä»¥ fork äº†æ­¤ä»“åº“å¹¶æ‹‰å–æºç è¿›è¡Œä¿®æ”¹ï¼Œç›¸å…³ API ä»ä¿æŒä¸ hox ä¸€è‡´

- ä¹‹æ‰€ä»¥åšè¿™ä¸ª devtoolsï¼ŒåŸå› åœ¨äºæˆ‘ä»¬ä½¿ç”¨äº† createModel åŒ…è£¹ä¹‹åï¼Œä¸çŸ¥é“è¿™ä¸ªæ•°æ®æ˜¯å¦çœŸçš„è¢«æŒä¹…åŒ–ã€å…¨å±€å…±äº«ï¼Œåªèƒ½é€šè¿‡åœ¨ç»„ä»¶ä¸­ import è¿™ä¸ªæ•°æ®æºï¼Œç„¶å console.log æ‰“å°ï¼Œç„¶åçœ‹æ˜¯å¦çœŸçš„è¢«ä¿®æ”¹ã€‚

- è¿˜æœ‰å°±æ˜¯å½“å…¶ä»–äººæ¥æ‰‹é¡¹ç›®ä¹‹åï¼Œä»–æƒ³æŸ¥çœ‹ä¸€äº›å·²ç»å­˜åœ¨äºå…¨å±€å…±äº«çš„ Modelï¼Œå¹¶æ²¡æœ‰ä¸€ä¸ªå±•ç¤ºå…¨å±€å…±äº«æ•°æ®çš„æ¸ é“ï¼Œæ‰€ä»¥ `sugar-hox-dev-tools` å‡ºç”Ÿäº†ã€‚

> ç”±äºæˆ‘ä»¬é¡¹ç›®ä¸­ï¼Œæœ‰äº›å°å‹é¡¹ç›®æˆ–è€…ç‹¬ç«‹æ¨¡å—ï¼Œéƒ½æœ‰ç”¨åˆ°äº† hoxï¼Œäºæ˜¯ï¼Œæˆ‘å†³å®šå…ˆå†™ä¸€ä¸ªç®€æ˜“ç‰ˆçš„ devtoolsï¼Œå‡‘åˆç€ç”¨ï¼Œäºæ˜¯ `sugar-hox-devtools` å‡ºç°äº†

## å¿«é€Ÿå¼€å§‹

### å®‰è£…

```bash
npm install sugar-hox-devtools --save
```

### åˆ›å»ºä¸€ä¸ª model

> è¿™é‡Œçš„è¯´æ˜æ‹·è‡³ hox æ–‡æ¡£ï¼Œ[æ›´å¤šè¯¦æƒ…ç‚¹å‡»è¿™é‡Œè®¿é—®](https://github.com/umijs/hox/blob/master/README-cn.md#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA-model)

```js
import { useState } from 'react'
import hoxAPI from 'sugar-hox-devtools'

function useCounter() {
  const [count, setCount] = useState(0)
  const decrement = () => setCount(count - 1)
  const increment = () => setCount(count + 1)
  return {
    count,
    decrement,
    increment,
  }
}

useCounter.namespace = 'useCounter' // è¿™é‡Œéœ€è¦ç»™æ¯ä¸€ä¸ª model éƒ½æ·»åŠ å‘½åç©ºé—´æ ‡è¯†

export default hoxAPI.createModel(useCounter)
```

### ä½¿ç”¨ model

> è¿™é‡Œçš„è¯´æ˜æ‹·è‡³ hox æ–‡æ¡£ï¼Œ[æ›´å¤šè¯¦æƒ…ç‚¹å‡»è¿™é‡Œè®¿é—®](https://github.com/umijs/hox/blob/master/README-cn.md#%E4%BD%BF%E7%94%A8-model)

```js
// åœ¨ç»„ä»¶ä¸­è°ƒç”¨è¿™ä¸ª Hook ï¼Œå°±å¯ä»¥è·å–åˆ° model çš„æ•°æ®äº†ã€‚
import counterModel from '../models/counter'

function App(props) {
  const { counter, increment, decrement } = counterModel()
  return (
    <div>
      <p>{counter}</p>
      <button onClick={decrement}>-1</button>
      <button onClick={increment}>+1</button>
    </div>
  )
}
```

### å¼€å¯ DevTools

`sugar-hox-devtools` æŠ›å‡ºä¸€ä¸ªç»„ä»¶ï¼Œè°ƒç”¨æ­¤ç»„ä»¶å³å¯ï¼›æ‰€æœ‰ç»è¿‡`createModel`åŒ…è£¹åçš„ modelï¼Œéƒ½ä¼šè¢«æ³¨å…¥æ·»åŠ åˆ° `window.sugarHox` ä¸Šã€‚æ§åˆ¶å°æ‰“å° window.sugarHox å°±èƒ½æ‹¿åˆ°æ•°æ®ã€‚

```js
import React, { useState } from 'react'
import sugar from 'sugar-hox-devtools'

const SugarHoxDevTools = sugar.SugarHoxDevTools

function App() {
  const [showDevTools, setShowDevTools] = useState(true)

  return (
    <div>
      ...
      {showDevTools && (
        <SugarHoxDevTools onClose={() => setShowDevTools(false)} />
      )}
    </div>
  )
}
```

## ç»„ä»¶å‚æ•°

| å‚æ•°            | è¯´æ˜                | ç±»å‹       | é»˜è®¤å€¼             |
| --------------- | ------------------- | ---------- | ------------------ |
| title           | è‡ªå®šä¹‰              | string     | sugar-hox-devtools |
| closeIcon       | å…³é—­ icon           | ReactNode  | X                  |
| onClose         | ç‚¹å‡» closeIcon æ–¹æ³• | () => void | -                  |
| maxScrollHeight | å®¹å™¨æ»šåŠ¨çš„æœ€å¤§é«˜åº¦  | number     | 200                |

## ä¸»è¦æ€è·¯

æˆ‘ä»¬è¦çŸ¥é“ä¸€ç‚¹ï¼Œé‚£å°±æ˜¯ hox æä¾›çš„ API ï¼Œæ˜¯é€šè¿‡ custom Hooks æ¥å®šä¹‰ model çš„

åœ¨æˆ‘ä»¬ä¸ä½¿ç”¨ hox çš„ API æ—¶ï¼Œæˆ‘ä»¬å†™çš„ hook å°±æ˜¯ä¸€ä¸ªæ™®é€š hookï¼Œå¦‚æœé€šè¿‡ hox çš„ `createModel` åŒ…è£¹ä¹‹åï¼Œè¿™ä¸ª hook å°±å˜æˆäº†æŒä¹…åŒ–ï¼Œä¸”å…¨å±€å…±äº«çš„æ•°æ®ã€‚

æ¸…æ¥šè¿™ä¸ªç‰¹ç‚¹å¾ˆå…³é”®ï¼ææ¸…æ¥šè¿™ç‚¹ä¹‹åï¼Œå¼€å‘è¿™ä¸ª devtools å°±å˜å¾—ç®€å•äº†ï½

å¤§è‡´æ€è·¯ :

- å°†æ‰€æœ‰è¢« createModel åŒ…è£¹åçš„ hookï¼Œéƒ½æŒ‚è½½åˆ° window ä¸‹ [è¿™å°±å¾—ä¿®æ”¹ hox çš„æºç äº†]
- ç›®å‰æš‚å®šåªåš model æ•°æ®çš„å±•ç¤ºï¼Œè‡ªç„¶è€Œç„¶çš„ï¼Œå¾—æŠŠ custom hook ä¸­çš„å‡½æ•°ç±»å‹å‰”é™¤æ‰
- è§£å†³æ‰æ•°æ®å“åº”é—®é¢˜ï¼Œå¾—åˆ° model çš„æœ€æ–°å€¼ï¼Œç”¨äºç»„ä»¶ä¸­å±•ç¤º
- é€’å½’éå†ï¼Œæ•°æ®å¤„ç†

## æ­¥éª¤

### å®ç°æ¯ä¸ª hook å”¯ä¸€

æˆ‘ä»¬ç»™ createModel ä¼ é€’çš„æ˜¯ä¸€ä¸ª hookï¼Œé‚£ä¹ˆæˆ‘ä»¬ç»™æ¯ä¸€ä¸ª hook æ³¨å…¥ä¸€ä¸ªå‘½åç©ºé—´ï¼Œç¡®ä¿å…¶å”¯ä¸€æ€§ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸ºäº†æŒ‚è½½åˆ° window ä¸Šæ—¶ï¼Œæ¯ä¸€ä¸ª key å¯¹åº”çš„ model æ•°æ®

```js
// è‡ªå®šä¹‰çš„hook
function useSugarModel() {}
useSugarModel.namespace = 'useSugarModel'

export default createModel(useSugarModel)
```

ç„¶åä¿®æ”¹ hox ä¸­ createModel æºç ï¼ŒåŸæ¥åªéœ€è¦ç»™ Executor ä¼ é€’ 2 ä¸ªå­—æ®µï¼Œç°åœ¨ç»™å®ƒæ”¯æŒ namespaceï¼Œ[ä»£ç å¯çœ‹è¿™é‡Œ](https://github.com/SugarTurboS/sugar-hox-devtools/blob/master/src/hox/create-model.tsx#L16)

```js
export function createModel<T, P>(hook: ModelHook<T, P>, hookArg?: P) {
  const container = new Container(hook);
  render(
    <Executor
      onUpdate={val => {
        container.data = val;
        container.notify();
      }}
      hook={() => hook(hookArg)}
      namespace={(hook as any).namespace} // æ–°å¢æ”¯æŒ namespace æ ‡è¯†
    />
  );
}
```

### è¿‡æ»¤å‡½æ•°æ–¹æ³•ï¼ŒæŒ‚è½½åˆ° window ä¸Š

æˆ‘ä»¬å‰æœŸæš‚æ—¶åªéœ€è¦æ•°æ®ï¼Œå¹¶ä¸éœ€è¦çŸ¥é“æœ‰ä»€ä¹ˆæ–¹æ³•ï¼Œæ‰€ä»¥å¯ä»¥ç°å°† hook ä¸­çš„æ–¹æ³•è¿‡æ»¤ï¼Œç„¶åå°† hook æŒ‚è½½åˆ° window ä¸‹ï¼Œ[ä»£ç å¯çœ‹è¿™é‡Œ](https://github.com/SugarTurboS/sugar-hox-devtools/blob/master/src/hox/executor.tsx#L13)

```js
export function Executor<T>(props: {
  hook: () => ReturnType<ModelHook<T>>
  onUpdate: (data: T) => void
  namespace: string
}) {
  const data = props.hook()
  props.onUpdate(data)
  // ä¸‹é¢ä¸ºä¿®æ”¹çš„ä»£ç ï¼ŒæŒ‚è½½åˆ° window.sugarHox ä¸‹
  if (!(window as any).sugarHox) {
    window.sugarHox = {}
  }
  let maps = {}
  const keys = Object.keys(data)

  for (let key of keys) {
    if (typeof data[key] !== 'function') {
      maps[key] = data[key]
    }
  }

  window.sugarHox = {
    ...window.sugarHox,
    [props.namespace]: { ...maps },
  }

  return null as ReactElement
}
```

### æ•°æ®å“åº”ï¼Œç›‘å¬ window.sugarHox çš„æ”¹å˜

æˆ‘ä»¬å¯ä»¥é€šè¿‡ `window.sugarHox` å»å¾—åˆ°æ‰€æœ‰é€šè¿‡ createModel æŒ‚è½½åˆ°å…¨å±€çš„å…±äº«çŠ¶æ€æ•°æ®ï¼Œä½†è¿˜æœ‰ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯æˆ‘ä»¬ä¿®æ”¹ model å€¼ä¹‹åï¼Œæˆ‘ä»¬è¦å®æ—¶å“åº”ï¼Œäºæ˜¯é€šè¿‡ Object.defineProperty è¿›è¡Œé‡å†™ set ã€get æ–¹æ³•ï¼Œ[ä»£ç çœ‹è¿™é‡Œ](https://github.com/SugarTurboS/sugar-hox-devtools/blob/master/src/components/Main/index.js#L6)

```js
// sugarDevTools ç»„ä»¶
componentDidMount() {
  window.tempHox = {};
  const _this = this;
  Object.defineProperty(window, 'sugarHox', {
    set: function(value) {
      window.tempHox = value;
      _this.setState({
        model: value
      });
    },
    get: function() {
      return window.tempHox;
    }
  });
}

```

ç”±äºä½¿ç”¨ Object.defineProperty ä¼šå­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œäºæ˜¯æ”¹ç”¨ Proxy è¿›è¡Œä»£ç†ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥å»çœ‹çœ‹è¿™ä¸¤è€…çš„åŒºåˆ«

### é€’å½’éå†æ•°æ®

æ ¸å¿ƒç‚¹å°±æ˜¯å°† window.sugarHox å¯¹è±¡ï¼Œæ„é€ æˆ antd tree æ‰€æ”¯æŒçš„æ•°æ®æ ¼å¼ï¼Œ[ä»£ç åœ¨è¿™é‡Œ](https://github.com/SugarTurboS/sugar-hox-devtools/blob/master/src/components/DevTools/index.js#L93)

## æœ€å

è¯»åˆ°è¿™ä½ å·²ç»æŠŠè¿™ä¸ªç®€æ˜“ç‰ˆçš„ sugar-hox-devtools åŸºæœ¬æ€æƒ³æŒæ¡äº†ï¼ŒåæœŸæ­£åœ¨è§„åˆ’è¯¥ devtools çš„æ›´å¤šåŠŸèƒ½ï¼Œå€Ÿé‰´ [redux-devtools-extension](https://github.com/zalmoxisus/redux-devtools-extension) çš„ä¸€äº›åŠŸèƒ½ï¼Œæ ¸å¿ƒä¸æ˜¯é€ è½®å­ï¼Œè€Œæ˜¯é€šè¿‡é€ è½®å­å»æ€è€ƒä¸€äº›é—®é¢˜ï¼Œå»å­¦åˆ°ä¸€äº›ä¸œè¥¿ã€‚åŠ æ²¹ï¼Œæ‰“å·¥äººï½

## ç›¸å…³é“¾æ¥

- STSC ç»„ç»‡: https://github.com/SugarTurboS
- å›¢é˜Ÿåšå®¢: https://github.com/SugarTurboS/Blogs
- å¼€æºç¤¾åŒº: https://github.com/SugarTurboS/Sugar-Community
